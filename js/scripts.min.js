// Результат поиска в блоке Top organizers
$('.organizers__field button').click(function(){
	$('.organizers__heading').text('Search results');
	$('.organizers__list li').clone().appendTo('.organizers__list');
})



// Подсказка в шапке
$(document).ready(function(e){
	$('.overlay').addClass('active');
	$('.header__hint').addClass('active');
})
$('html').click(function(){
	$('.overlay').removeClass('active');
	$('.header__hint').removeClass('active');
})

// Календарь
$('.header__date .header__link').click(function(e){
	e.preventDefault();
	e.stopPropagation();
	$('.overlay').addClass('active');
	$(this).parent().addClass('active');
})
$('html').click(function(){
	$('.overlay').removeClass('active');
	$('.header__date').removeClass('active');
})



// Расположение блоков на главной
$(document).ready(function(){
	columnChange();
})

$(window).resize(function(){
	columnChange();
})
/*
function columnChange() {
	if ($(window).width() > 1024) {
		$('[data-desktop]').each(function(){
			var desktop = $(this).data('desktop');
			var column = $('.column[data-column='+desktop+']')
			var priority = $(this).data('priority');
			if (priority == "high") {
				$(this).prependTo(column);
			} else if (priority == "medium") {
				$(this).prependTo(column);
				$(this).insertAfter($('.column[data-column='+desktop+'] [data-priority="high"]'))
			} else {
				$(this).appendTo(column);
			}
		})
	}
	if ($(window).width() < 1024 && $(window).width() > 768) {
		$('[data-desktopsmall]').each(function(){
			var desktopsmall = $(this).data('desktopsmall');
			var column = $('.column[data-column='+desktopsmall+']')
			var priority = $(this).data('priority');
			if (priority == "high") {
				$(this).prependTo(column);
			} else if (priority == "medium") {
				$(this).prependTo(column);
				$(this).insertAfter($('.column[data-column='+desktopsmall+'] [data-priority="high"]'))
			} else {
				$(this).appendTo(column);
			}
		})
	}
	if ($(window).width() < 768 && $(window).width() > 640) {
		$('[data-tablet]').each(function(){
			var tablet = $(this).data('tablet');
			var column = $('.column[data-column='+tablet+']')
			var priority = $(this).data('priority');
			if (priority == "high") {
				$(this).prependTo(column);
			} else if (priority == "medium") {
				$(this).prependTo(column);
				$(this).insertAfter($('.column[data-column='+tablet+'] [data-priority="high"]'))
			} else {
				$(this).appendTo(column);
			}
		})
	}
	if ($(window).width() < 640) {
		$('[data-mobile]').each(function(){
			var mobile = $(this).data('mobile');
			var column = $('.column[data-column='+mobile+']')
			var priority = $(this).data('priority');
			if (priority == "high") {
				$(this).prependTo(column);
			} else if (priority == "medium") {
				$(this).prependTo(column);
				$(this).insertAfter($('.column[data-column='+mobile+'] [data-priority="high"]'))
			} else {
				$(this).appendTo(column);
			}
		})
	}
}
*/
function columnChange() {
	$('[data-desktop]').each(function(){
			if ($(window).width() > 1024) {
				var columnname = $(this).data('desktop');
			}

			if ($(window).width() < 1024 && $(window).width() > 768) {
				var columnname = $(this).data('desktopsmall');
			}

			if ($(window).width() < 768 && $(window).width() > 640) {
				var columnname = $(this).data('tablet');
			}

			if ($(window).width() < 640) {
				var columnname = $(this).data('mobile');
			}

			var column = $('.column[data-column='+columnname+']')
			var priority = $(this).data('priority');
			if (priority == "high") {
				$(this).prependTo(column);
			} else if (priority == "medium") {
				$(this).prependTo(column);
				$(this).insertAfter($('.column[data-column='+columnname+'] [data-priority="high"]'))
			} else {
				$(this).appendTo(column);
			}
		});
}





// Плавное появление блоков при скролле
window.sr = ScrollReveal();
var fooReveal = {delay: 100, distance: '40px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000};
sr.reveal('sr', fooReveal);



// Кастомный скроллбар (jQuery Scrollbar)
$(document).ready(function(){
	$('.scrollbar-inner').scrollbar();
});



// Фиксировать экран для самописных модальных окон
function fixscreen() {
  window.scroll = $(window).scrollTop();
  $("body").css('top', -scroll + 'px').toggleClass('noscroll');
}

function unfixscreen() {
  $("body").css('top', "0").toggleClass('noscroll');
  $(window).scrollTop(scroll);
}



// Показ прелоадера при отправке формы
$(document).on({
  ajaxStart: function() { $(".preloader").addClass("active");},
  ajaxStop: function() { $(".preloader").removeClass("active");}
});



// Плавно скрыть/показать блок
function hideblock(el) {
  setTimeout(function() {$(el).show();}, 700);
  setTimeout(function() {$(el).css("opacity", "1");}, 900);
}

function showblock(el) {
  setTimeout(function() {$(el).css("opacity", "0");}, 700);
  setTimeout(function() {$(el).show();}, 900);
}



// Ссылки навигации по странице (добавить класс nav к ссылке с #)
$("a.nav").click(function(event){     
    event.preventDefault();
    $('html,body').animate({scrollTop:$(this.hash).offset().top}, 1200);
});



// Проверка формы на правильность введенных данных
$(".fake-button").click(function(){
    window.activeform = $(this).parents("form").attr("id");

    checkselects();
    checkinputs();
    checkandsubmit();
});

// 1. Проверка селектов
function checkselects() {
    if (select1val === false) { $('#'+activeform+' select[name="city"]').parent().addClass("error"); }
    if (select2val === false) { $('#'+activeform+' select[name="clienttype"]').parent().addClass("error"); }
    if (select3val === false) { $('#'+activeform+' select[name="orgform"]').parent().addClass("error"); }
}

// 2. Проверка текстовых input'ов
function checkinputs() {
    // Проверка обычных полей на заполненность
    checkempty();
    
    // Проверка поля email
    function isEmail(email) {
        var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        return regex.test(email);
    }
    if ( isEmail($('#'+activeform+' input[name="email"]').val()) === false) {
        $('#'+activeform+' input[name="email"]').parent().addClass("error")
    } else {$('#'+activeform+' input[name="email"]').parent().removeClass("error")}
}

// 3. Проверка на ошибочные поля и отправка формы
function checkandsubmit() {
    window.formerrors = 0;
    $('#'+activeform).find("div.error").each(function(){
        formerrors += 1; 
    });
    if (formerrors === 0) {
        $('#'+activeform).submit();
    }
}

// Скрипт проверки на пустое значение
function checkempty() {
    $('#'+activeform+' input[data-required]').each(function(){
        if (!$(this).val()) {
            $(this).parent().addClass("error")
        } else {$(this).parent().removeClass("error")}
    });
}

// Проверка номера телефона
function phonenumerlength() {
   if ( $('#'+activeform+' input[name="tel"]').val().match(/\d/g).length < 11) {
       $('#'+activeform+' input[name="tel"]').addClass("error")
   } else {$('#'+activeform+' input[name="tel"]').removeClass("error")}
}

// Убрать ошибку при изменении input'а
$("input").on("keyup change", function(){
   $(this).parent().removeClass("error"); 
});

// Только цифры в input'е
$('.onlynumber').change(function(e){
  if (/\D/g.test(this.value))
  {
    this.value = this.value.replace(/\D/g, '');
  }
});

// ################## //
// Только буквы в input'е
// ################## //
$('.letteronly').bind('keyup blur',function(){ 
    var node = $(this);
    node.val(node.val().replace(/\d/g,'') ); }
);



// AJAX форма
$(document).ready(function() {
    $('form').ajaxForm(function() {
        // Успешная отправка формы
        $.fancybox([{href : '#success', fitToView   : false, autoSize    : true, openEffect  : 'fade', closeEffect : 'fade',}]);
    }); 
}); 




// Переход названия поля в активное состояние
$("input, textarea").focus(function(){
   window.nowform = $(this).closest("form").attr("id");
   $(this).prev().addClass('active');
});

$("input, textarea, select").on("blur change", function(){
    window.nowform = $(this).closest("form").attr("id");
   if ($(this).val() === "") {
       $(this).prev().removeClass('active');
   }
});



// Маска для поля ввода телефона
$(document).ready(function(){
   $("input[name='tel']").inputmask("+7 (999) 999-99-99");
});



// Кросс-браузерный Placeholder
function supports_input_placeholder() {var i = document.createElement('input'); return 'placeholder' in i;}

if (!supports_input_placeholder()) {
  var fields = document.getElementsByTagName('INPUT');
  for(var i=0; i < fields.length; i++) {
    if(fields[i].hasAttribute('placeholder')) {
      fields[i].defaultValue = fields[i].getAttribute('placeholder');
      fields[i].onfocus = function() { if(this.value == this.defaultValue) this.value = ''; }
      fields[i].onblur = function() { if(this.value == '') this.value = this.defaultValue; }
    }
  }
}